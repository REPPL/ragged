# v0.4.4 - Memory Foundation: Personas & Tracking

**Hours**: 35-40 | **Priority**: P0 - Core Feature | **Status**: Planned

**Dependencies**: v0.4.3 complete (Quality baseline established)

---

## Overview

Implement personal memory system foundation with persona management, interaction tracking, and knowledge graph initialization.

**Vision**: Enable ragged to remember user context, preferences, and interaction history - all locally with zero cloud dependencies.

**Theoretical Foundation**: Inspired by [Context Engineering 2.0](../../../acknowledgements/context-engineering-2.0.md), this release implements **structured context layering**—organising personal knowledge as hierarchical entities (users → topics → documents → temporal relationships). Knowledge graphs reduce computational uncertainty (entropy reduction) by making relationships explicit and machine-understandable.

---

## Core Deliverables

### 1. Persona Manager (8h)

User persona system for context switching.

```python
# Usage
ragged persona create researcher --description "ML researcher" --focus "RAG, NLP, privacy"
ragged persona switch researcher
ragged persona list
```

**Features**:
- Create/switch/delete personas
- Focus areas and preferences
- Usage statistics
- Active project tracking

**Files**:
- `ragged/memory/persona.py` (~250 lines)
- `tests/memory/test_persona.py` (~150 lines)

---

### 2. Interaction Tracking (6h)

SQLite-based interaction history storage.

**Schema**:
```sql
CREATE TABLE interactions (
    id TEXT PRIMARY KEY,
    persona TEXT NOT NULL,
    query TEXT NOT NULL,
    response TEXT,
    timestamp TIMESTAMP,
    retrieved_doc_ids TEXT,  -- JSON
    model_used TEXT,
    latency_ms REAL,
    feedback TEXT,           -- positive/negative
    session_id TEXT
);
```

**Features**:
- Record all queries and responses
- Track retrieved documents
- User feedback collection
- Session management

**Files**:
- `ragged/memory/interactions.py` (~200 lines)
- `tests/memory/test_interactions.py` (~150 lines)

---

### 3. Knowledge Graph Foundation (6h)

Kuzu-based graph database for relationships.

**Schema**:
```cypher
// Nodes
CREATE NODE TABLE User(name STRING, created_at TIMESTAMP);
CREATE NODE TABLE Topic(name STRING, interest_level FLOAT);
CREATE NODE TABLE Document(doc_id STRING, title STRING);

// Relationships
CREATE REL TABLE INTERESTED_IN(FROM User TO Topic, frequency INT);
CREATE REL TABLE ACCESSED(FROM User TO Document, timestamp TIMESTAMP);
```

**Features**:
- User-topic relationships
- Document access tracking
- Topic co-occurrence
- Temporal information

**Files**:
- `ragged/memory/graph.py` (~300 lines)
- `tests/memory/test_graph.py` (~200 lines)

---

### 4. CLI Commands (8h)

Memory management interface.

```bash
# Persona management
ragged persona create <name> --description "..." --focus "topics"
ragged persona switch <name>
ragged persona list
ragged persona delete <name> --confirm

# Memory viewing
ragged memory list --limit 10 --persona researcher
ragged memory topics --persona researcher
ragged memory timeline --since "-30d"
ragged memory show <interaction-id>

# Memory management
ragged memory delete <interaction-id> --confirm
ragged memory export <output-file> --persona researcher
ragged memory clear --persona researcher --confirm
```

**Files**:
- Update `ragged/cli/main.py` with command groups
- `tests/cli/test_memory_commands.py` (~200 lines)

---

### 5. Comprehensive Testing (7-9h)

Dedicated testing effort for memory system.

**Test Coverage**:
- Unit tests: Persona, interactions, graph
- Integration tests: Full workflows
- Privacy tests: Local-only validation
- Persistence tests: Survive restarts

---

## Testing Requirements

**Coverage**: ≥85% for memory modules

**Privacy Tests**:
- ✅ No network calls (monitor all connections)
- ✅ Data stays in `~/.ragged/memory/`
- ✅ Persona isolation (no cross-contamination)

---

## Documentation

**Required** (~1,200 lines):

1. **Tutorial**: Getting Started with Personas (~400 lines)
2. **Guide**: Memory System User Guide (~500 lines)
3. **Reference**: Memory API Documentation (~300 lines)

---

## Success Criteria

Version 0.4.4 is successful if:

1. ✅ Persona system works seamlessly
2. ✅ Memory tracking transparent to users
3. ✅ All interactions stored locally
4. ✅ Users can view/edit/delete memory
5. ✅ Knowledge graph initialized
6. ✅ Privacy guaranteed (100% local)
7. ✅ 85%+ test coverage
8. ✅ Performance: Persona switch <100ms, interaction record <50ms
9. ✅ CLI commands functional
10. ✅ Documentation complete

---

## Performance Targets

- Persona switching: <100ms
- Interaction recording: <50ms (async)
- Graph query: <300ms
- Memory retrieval: <200ms

---

## File Summary

**New Files** (~2,100 lines):
- Memory core: ~750 lines
- CLI: Update existing
- Tests: ~700 lines
- Documentation: ~1,200 lines

**Dependencies**:
- `kuzu>=0.6.0` - Graph database
- `pydantic>=2.0` - Already used
- `python-dateutil>=2.8` - Temporal operations

---

## Storage Architecture

```
~/.ragged/memory/
├── profiles/
│   ├── personas.yaml          # Persona definitions
│   ├── preferences.db          # SQLite
│   └── user_profile.yaml
├── interactions/
│   ├── queries.db              # SQLite
│   └── feedback.db
├── semantic/
│   └── memory_vectors/         # ChromaDB (future)
└── graph/
    └── kuzu_db/                # Kuzu database
```

---

## Risk Assessment

**Medium Risk**:
- Kuzu integration complexity → Mitigation: Comprehensive examples and tests
- Privacy guarantees → Mitigation: Explicit testing, no network calls

**Low Risk**:
- SQLite integration (well-established)
- YAML configuration (simple)

---

## Related Documentation

- [v0.4.0 Overview](README.md)
- [v0.4.0 Detailed Spec](v0.4.0-DETAILED-SPEC.md) - Part 2: Milestone 1
- [v0.4.3](v0.4.3.md) - Code quality (previous)
- [v0.4.5](v0.4.5.md) - Stability & performance (next)

---
