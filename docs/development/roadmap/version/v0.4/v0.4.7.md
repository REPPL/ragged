# v0.4.0 - Temporal Memory System

**Hours**: 40-45 | **Priority**: P0 - Advanced Feature | **Status**: Planned

**Dependencies**: v0.4.0 complete (Refactored codebase)

---

## Overview

Implement time-aware memory system enabling temporal fact storage, timeline queries, and historical activity tracking.

**Vision**: Ragged understands information changes over time and can answer "what was I working on last week?"

**Theoretical Foundation**: Extends [Context Engineering 2.0](../../../acknowledgements/context-engineering-2.0.md) **structured context layering** with temporal dimension. Temporal knowledge graphs make time-based relationships explicit (when facts were valid, when topics were accessed, activity timelines), further reducing uncertainty through time-aware context organisation.

---

## Core Deliverables

### 1. Temporal Fact Storage (8h)

Support facts that change over time.

**Examples**:
- "I work at Company X" (current)
- "I used to work at Company Y" (historical)
- "I'm learning Rust" (current)

**Features**:
- Valid-from/valid-to timestamps
- Fact versioning
- Historical queries

**Files**:
- `ragged/memory/temporal_facts.py` (~250 lines)
- `tests/memory/test_temporal_facts.py` (~200 lines)

---

### 2. Timeline Query Engine (12h)

Support time-based queries.

**Query Types**:
- "What was I working on last week?"
- "When did I first query about RAG?"
- "Show my activity for January"
- "What topics interested me in Q4?"

**Implementation**:
```python
class TemporalQueryEngine:
    def get_timeline(user, since, until) -> dict
    def get_activity_summary(user, period) -> dict
    def find_first_occurrence(user, topic) -> datetime
    def get_trending_topics(user, window) -> List[str]
```

**Files**:
- `ragged/memory/temporal.py` (~400 lines)
- `tests/memory/test_temporal.py` (~250 lines)

---

### 3. Temporal Reasoning (10h)

Understand temporal context in queries.

**Features**:
- Parse time expressions ("-30d", "last week", "January")
- Time-aware relevance scoring
- Recency weighting
- Temporal fact validation

---

### 4. CLI Temporal Commands (6h)

```bash
# Timeline queries
ragged memory timeline --since "-30d" --until "now"
ragged memory timeline --period "2025-01"

# Activity summaries
ragged memory activity --period "last-week"
ragged memory activity --period "Q4-2025"

# Topic trends
ragged memory trending --window "30d"

# First occurrence
ragged memory first-seen --topic "RAG"
```

---

### 5. Testing (4-7h)

Comprehensive temporal logic testing.

**Test Cases**:
- Time range queries
- Fact versioning
- Timeline accuracy
- Edge cases (timezone, DST)

---

## Success Criteria

Version 0.4.8 is successful if:

1. ✅ Temporal queries work correctly
2. ✅ Time-aware fact handling
3. ✅ Historical activity tracking
4. ✅ Timeline visualization functional
5. ✅ Performance acceptable (<500ms)
6. ✅ Timezone handling correct
7. ✅ 85%+ test coverage
8. ✅ Documentation complete

---

## Performance Targets

- Timeline query: <500ms
- Temporal fact lookup: <200ms
- Activity summary: <1s
- Trending topics: <300ms

---

## File Summary

**New Files** (~1,900 lines):
- Temporal core: ~650 lines
- CLI: ~200 lines
- Tests: ~450 lines
- Documentation: ~600 lines

---

## Related Documentation

- [v0.4 Detailed Spec](v0.4-DETAILED-SPEC.md) - Part 2: Milestone 3
- [v0.4.0](v0.4.0.md) - Refactoring (previous)
- [v0.4.0](v0.4.0.md) - LEANN backend (next)

---
