# v0.6.6: FastAPI REST Layer

**Focus:** RESTful API with OpenAPI documentation

**Hours:** 30-40 hours

**Dependencies:** v0.5.x (Vision features complete)

**Status:** Planned

---

## Overview

Version 0.6.6 creates a FastAPI REST layer enabling external integrations, mobile app development, and providing foundation for the production Svelte UI (v0.6.7-v0.6.9).

**What This Version Delivers:**
- FastAPI REST API with automatic OpenAPI documentation
- Authentication (API keys) and rate limiting (basic)
- Document management, query, and monitoring endpoints
- CORS configuration for UI-backend communication

**Why After Optimisation Features:**
- Can be developed in parallel with v0.6.0-v0.6.5
- Features stabilised and ready for API exposure
- Optimisation benefits apply to API responses

---

## Key Features

### API Endpoints

**Document Management:**
- `POST /documents/upload` - Upload PDF with vision
- `GET /documents` - List documents
- `GET /documents/{id}` - Get document details
- `DELETE /documents/{id}` - Delete document

**Queries:**
- `POST /query/text` - Text query
- `POST /query/image` - Image query (base64 encoded)
- `POST /query/hybrid` - Hybrid text+image query

**System:**
- `GET /health` - Health check
- `GET /gpu/stats` - GPU statistics
- `GET /storage/info` - Storage information

### Infrastructure

- **OpenAPI:** Auto-generated specification
- **Authentication:** API key-based
- **Rate Limiting:** Per-key quotas (basic)
- **CORS:** Configured for UI origin
- **Validation:** Pydantic v2 models

---

## Implementation

**Phase 1: Core API (15-20h)**
- FastAPI application setup
- Document and query endpoints
- Pydantic models

**Phase 2: Infrastructure (8-10h)**
- Authentication middleware
- Rate limiting (basic)
- CORS configuration
- Error handling

**Phase 3: Testing (7-10h)**
- Integration tests
- API documentation
- Usage examples

---

## Success Criteria

- [ ] All v0.5 features exposed via REST
- [ ] OpenAPI documentation complete
- [ ] API response time <100ms (excluding processing)
- [ ] Authentication and rate limiting functional
- [ ] Integration tests passing

---

## Files Created (~1,500 lines)

- `src/api/main.py` - FastAPI application
- `src/api/routes/` - Endpoint modules
- `src/api/models/` - Pydantic models
- `src/api/middleware/` - Auth, rate limiting
- `tests/api/` - API tests

---

## API Contract Specification

### OpenAPI 3.1 Template Structure

**File**: `src/api/openapi.yaml` (generated from FastAPI decorators)

**Core Structure:**
```yaml
openapi: 3.1.0
info:
  title: ragged API
  version: 1.0.0
  description: Multi-modal RAG system with vision capabilities

servers:
  - url: http://localhost:8000/api/v1
    description: Local development
  - url: https://api.ragged.dev/v1
    description: Production (future)

components:
  schemas:
    Document:
      type: object
      properties:
        document_id: { type: string, format: uuid }
        filename: { type: string }
        pages: { type: integer }
        embeddings_count: { type: integer }
        created_at: { type: string, format: date-time }

    QueryRequest:
      type: object
      required: [query]
      properties:
        query: { type: string }
        context_scope: { type: string, enum: [narrow, medium, broad], default: medium }
        top_k: { type: integer, default: 5, minimum: 1, maximum: 20 }

    QueryResult:
      type: object
      properties:
        chunk_id: { type: string }
        content: { type: string }
        score: { type: number }
        document_id: { type: string }
        page_number: { type: integer }
        metadata: { type: object }

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
```

**Full spec reference**: See v0.6/README.md API Contracts section for complete endpoint contracts.

**SDK Generation**: Use OpenAPI Generator to create client SDKs in v0.6.10.

---

## Related Documentation

- [v0.6.x Overview](./README.md) - Complete v0.6 series
- [v0.6.7](./v0.6.7.md) - Svelte Core UI (depends on this API)
- [v0.6.8](./v0.6.8.md) - Svelte Advanced Features
- [v0.6.9](./v0.6.9.md) - Svelte Polish & PWA
- [v0.6.10](./v0.6.10.md) - Public API launch

---

**Status:** Planned - API foundation for production UI
